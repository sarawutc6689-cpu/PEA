<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ระบบค้นหาและรับบิล</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif}
body{
  margin:0;
  background:linear-gradient(135deg,#f6f0ff,#ffffff);
  min-height:100vh;
}
.container{
  max-width:780px;
  margin:50px auto;
  background:#fff;
  padding:35px;
  border-radius:22px;
  box-shadow:0 18px 45px rgba(138,43,226,.18);
}
h1{
  text-align:center;
  color:#6a0dad;
  margin-bottom:10px;
}
.subtitle{
  text-align:center;
  color:#8a6dd8;
  margin-bottom:30px;
}
.search-box{
  position:relative;
}
.search-box input{
  width:100%;
  padding:16px 18px;
  border-radius:14px;
  border:2px solid #e3d7ff;
  font-size:1.05rem;
  outline:none;
}
.search-box input:focus{
  border-color:#8a2be2;
  box-shadow:0 0 0 4px rgba(138,43,226,.15);
}
.result-list{
  margin-top:8px;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 8px 25px rgba(0,0,0,.08);
}
.result-item{
  padding:14px 18px;
  background:#fff;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.result-item:hover{
  background:#f3ecff;
}
.result-item strong{
  color:#6a0dad;
}
.result-item small{
  display:block;
  color:#777;
  margin-top:2px;
}
.card{
  display:none;
  margin-top:30px;
  background:#f9f5ff;
  padding:25px;
  border-radius:18px;
}
.row{margin-bottom:14px}
.label{
  color:#8a6dd8;
  font-weight:600;
}
.status{
  display:inline-block;
  padding:6px 18px;
  border-radius:50px;
  font-weight:600;
}
.wait{background:#fff8e1;color:#f57c00}
.done{background:#e6f7e9;color:#2e7d32}
.update{
  margin-top:20px;
}
button{
  background:linear-gradient(135deg,#8a2be2,#9370db);
  color:#fff;
  border:none;
  padding:14px 26px;
  border-radius:14px;
  font-size:1rem;
  font-weight:600;
  cursor:pointer;
}
button:disabled{
  opacity:.5;
  cursor:not-allowed;
}
.message{
  margin-top:20px;
  text-align:center;
  font-weight:600;
}
/* Footer */
    footer {
      text-align: center;
      padding: 30px;
      color: var(--gray-color);
      font-size: 0.9rem;
      border-top: 1px solid #eee;
      background-color: rgba(248, 249, 250, 0.8);
    }
    
    footer p {
      margin-bottom: 8px;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }
    
    .footer-links a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
    }
    
    .footer-links a:hover {
      color: var(--secondary-color);
      text-decoration: underline;
    }

  .dash-btn-box{
  text-align:center;
  margin-bottom:25px;
}

.dash-btn{
  display:inline-block;
  padding:12px 24px;
  border-radius:50px;
  background:linear-gradient(135deg,#6a0dad,#9370db);
  color:#fff;
  font-weight:600;
  text-decoration:none;
  box-shadow:0 8px 20px rgba(138,43,226,.25);
  transition:.25s ease;
}

.dash-btn i{
  margin-right:8px;
}

.dash-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 12px 28px rgba(138,43,226,.35);
}

</style>
</head>

<body>
<div class="container">
  <h1><i class="fas fa-file-invoice"></i> ระบบค้นหาและรับบิล</h1>
  <div class="subtitle">พิมพ์เลขบิล ระบบค้นหาให้อัตโนมัติ</div>

  <div class="dash-btn-box">
  <a href="https://sarawutc6689-cpu.github.io/TK23/DashBoard.html"
     target="_blank"
     class="dash-btn">
    <i class="fas fa-chart-pie"></i> Dashboard บิลค้าง
  </a>
</div>

  
  <div class="search-box">
    <input id="billInput" placeholder="พิมพ์เลขบิล 5 ตัวท้ายสุด">
    <div id="list" class="result-list"></div>
  </div>

  <div id="card" class="card">
    <div class="row"><span class="label">เลขที่บิล:</span> <span id="cBill"></span></div>
    <div class="row"><span class="label">สถานที่:</span> <span id="cPlace"></span></div>
    <div class="row"><span class="label">รายละเอียด:</span> <span id="cDetail"></span></div>
    <div class="row">
      <span class="label">สถานะ:</span>
      <span id="cStatus" class="status"></span>
    </div>

    <div id="updateBox" class="update">
      <label>
        <input type="checkbox" id="confirmChk">
        ยืนยันการรับบิลแล้ว
      </label>
      <br><br>
      <button id="updateBtn" disabled>ยืนยันรับบิล</button>
    </div>
  </div>

  <div id="msg" class="message"></div>
</div>

  <!-- Footer -->
    <footer>
      <p>ระบบค้นหาและรับใบเสร็จ  © 2026 | พัฒนาโดย Sarawut.C</p>
      <p>สำหรับใช้ส่วนตัวเท่านั้น เพื่อสะดวกต่อการทำงาน</p>
    </footer>
  
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyF94UTfwqoCK8LS09wxBESuDdQWznuQGguRLuE5eaGIuSWZ1h1yLKLNdIRHbwcdhWy/exec";
let currentBill = null;
let timer = null;

const billInput = document.getElementById("billInput");
const list = document.getElementById("list");
const card = document.getElementById("card");
const msg = document.getElementById("msg");

const debounce = (fn,delay=400)=> (...args)=>{
  clearTimeout(timer);
  timer = setTimeout(()=>fn(...args),delay);
};

billInput.addEventListener("input", debounce(async e=>{
  const keyword = e.target.value.trim();
  card.style.display="none";
  msg.textContent="";

  if(keyword.length < 2){
    list.innerHTML="";
    return;
  }

  const res = await fetch(
    `${SCRIPT_URL}?action=search&keyword=${encodeURIComponent(keyword)}`
  );
  const data = await res.json();

  if(!data.success){
    list.innerHTML = `<div class="result-item">${data.message}</div>`;
    return;
  }

  renderList(data.results);
}));

function renderList(results){
  list.innerHTML="";
  results.forEach(b=>{
    const div = document.createElement("div");
    div.className="result-item";
    div.innerHTML=`
      <strong>${b.billNo}</strong>
      <small>${b.place}</small>
    `;
    div.onclick=()=>selectBill(b);
    list.appendChild(div);
  });
}

function selectBill(b){
  currentBill = b.billNo;
  list.innerHTML="";
  card.style.display="block";

  cBill.textContent = b.billNo;
  cPlace.textContent = b.place;
  cDetail.textContent = b.detail;

  cStatus.textContent = b.status || "รอรับบิล";
  cStatus.className = "status " + (b.status==="รับบิลแล้ว"?"done":"wait");

  updateBox.style.display = b.status==="รับบิลแล้ว"?"none":"block";
  confirmChk.checked=false;
  updateBtn.disabled=true;
}

confirmChk.onchange = e=>{
  updateBtn.disabled = !e.target.checked;
};

updateBtn.onclick = async ()=>{
  const res = await fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"update",
      billNo:currentBill
    })
  });
  const data = await res.json();

  if(data.success){
    cStatus.textContent="รับบิลแล้ว";
    cStatus.className="status done";
    updateBox.style.display="none";
    msg.style.color="green";
    msg.textContent="อัพเดทสถานะเรียบร้อยแล้ว";
  }else{
    msg.style.color="red";
    msg.textContent=data.message;
  }
};
</script>
</body>
</html>
